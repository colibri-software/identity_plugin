require 'spec_helper'

describe "Account pages" do
  # Sign up
  describe "when the user is creating an account" do
    it "should create a new user" do
      IdentityEngine::User.count.should == 0
      visit new_identity_path
      fill_in 'Name',                   with: 'test'
      fill_in 'Email',                  with: 'valid@example.com'
      find(:css, "input[id$='password']").set('test!password')

#      fill_in 'Password',               with: 'test!password'
      fill_in 'Password confirmation',  with: 'test!password' 
      click_button 'Register'
      IdentityEngine::User.count.should == 1
    end
  end

  # Not logged in
  describe "when the user is not logged in" do
    describe "when visting the login page" do
      it "should have content saying 'login below'" do
        visit login_path
        page.should have_content("login below")
      end

      it "should have an email field" do
        visit login_path
        page.should have_field("Email")
      end

      it "should have a password field" do
        visit login_path
        page.should have_field("Password")
      end

      it "should have a login button" do
        visit login_path
        page.should have_button("Login")
      end
    end

    describe "when visiting the home page" do
      it "should have content saying 'sign in'" do
        visit root_path
        page.should have_content("Sign in")
      end
    end
  end

  # Logged in
  describe "when the user is logged in" do
    before do
      @user = login
    end
  end


  # helpers
  private
  def login
  end
end

#    describe "when the user signs in" do
#    it "should provide a current user id" do

#  plugin_object = MyPlugin.new
#  env = {
#    'REQUEST_URI' => 'http://www.example.com/plugin/path/request/path',
#    'SCRIPT_NAME' => '/plugin/path'
#  }
#  plugin_object.prepared_rack_app.call(env)

